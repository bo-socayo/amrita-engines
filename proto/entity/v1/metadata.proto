syntax = "proto3";

package entity.v1;

option go_package = "entity-workflows/gen/entity/v1;entityv1";

import "google/protobuf/timestamp.proto";
import "buf/validate/validate.proto";

// EntityMetadata defines the identity and context of an entity workflow  
// This persists across all operations and continue-as-new cycles
message EntityMetadata {
  // üîµ ENTITY IDENTITY (workflow-managed)
  string entity_id = 1 [(buf.validate.field).string.pattern = "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$"]; // UUID v4 format
  string entity_type = 2 [(buf.validate.field).string.min_len = 1];   // Protobuf full URL
  
  // üü¢ AUTHORIZATION & TENANCY CONTEXT (set once at workflow start)
  string org_id = 3 [(buf.validate.field).string.min_len = 1];        // Organization identifier
  string team_id = 4 [(buf.validate.field).string.min_len = 1];        // Team within organization  
  string user_id = 5 [(buf.validate.field).string.min_len = 1];       // Acting user
  string environment = 6 [(buf.validate.field).string = {in: ["dev", "staging", "prod"]}]; // Environment
  string tenant = 7 [(buf.validate.field).string.min_len = 1];        // Top-level tenant isolation
  
  // üü° WORKFLOW METADATA (workflow-managed)
  google.protobuf.Timestamp created_at = 8;                           // When entity workflow was first created
}

// RequestContext contains per-operation/per-request specific data
// This is provided fresh with each update/signal by the client
message RequestContext {
  // üîê AUTHORIZATION (per-request - eventually from JWT)
  string org_id = 1 [(buf.validate.field).string.min_len = 1];        // Organization making the request
  string team_id = 2 [(buf.validate.field).string.min_len = 1];       // Team within organization
  string user_id = 3 [(buf.validate.field).string.min_len = 1];       // User making the request  
  string tenant = 4 [(buf.validate.field).string.min_len = 1];        // Tenant context
  string environment = 5 [(buf.validate.field).string = {in: ["dev", "staging", "prod"]}]; // Environment
  
  // üÜî REQUEST IDENTITY & DEDUPLICATION
  string idempotency_key = 6 [(buf.validate.field).string.min_len = 1, (buf.validate.field).string.max_len = 255]; // Client-provided idempotency key
  google.protobuf.Timestamp request_time = 7;                         // When this specific request was made
  
  // üìä OBSERVABILITY (optional)
  string request_id = 8;       // Request tracing ID
  string trace_id = 9;         // Distributed tracing ID
} 